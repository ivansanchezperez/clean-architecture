parameters:
- name: buildAppCommand
  type: string

steps:
  - template: _runtime.yml
  - template: _outdated-packages.yml
  - template: _audit-packages.yml
  - template: _install-dependencies.yml

  - script: npm run lint
    displayName: "âœï¸ Run lint"

  - script: npm run prettier:write
    displayName: "ğŸ¨ Run prettier"

  - task: Npm@1
    displayName: "ğŸ—ï¸ Build app"
    inputs:
      command: custom
      customCommand: ${{ parameters.buildAppCommand }}
      workingDir: "$(Build.SourcesDirectory)"
      verbose: false

  - task: Npm@1
    displayName: "âœ… Run unitary tests"
    inputs:
      command: custom
      customCommand: "run test:coverage"
      workingDir: "$(Build.SourcesDirectory)"
      verbose: false

  - task: PublishCodeCoverageResults@1
    displayName: "ğŸ“¢ Publish unitary tests results"
    inputs:
      codeCoverageTool: Cobertura
      summaryFileLocation: $(Build.SourcesDirectory)/coverage/cobertura-coverage.xml

  - task: PublishBuildArtifacts@1
    displayName: 'Publish artifact: dist'
    inputs:
      ArtifactName: 'dist'
      PathtoPublish: $(System.DefaultWorkingDirectory)/dist
          

